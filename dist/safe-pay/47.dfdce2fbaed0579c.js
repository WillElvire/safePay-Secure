"use strict";(self.webpackChunksafePay=self.webpackChunksafePay||[]).push([[47],{7627:(E,P,n)=>{n.d(P,{W:()=>t});var i=n(4650),o=n(6895),h=n(1102),r=n(6616),g=n(7044),C=n(1664);class t{constructor(d){this.location=d,this.direction="left",this.text="Retour en arriere",this.margin=5}ngAfterContentInit(){}ngOnInit(){}}t.\u0275fac=function(d){return new(d||t)(i.Y36(o.Ye))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-back-button"]],inputs:{direction:"direction",text:"text",margin:"margin"},decls:5,vars:1,consts:[["nz-button","","id","button",3,"click"],["nz-icon","","nzType","left"]],template:function(d,l){1&d&&(i.ynx(0),i.TgZ(1,"button",0),i.NdJ("click",function(){return l.location.back()}),i._UZ(2,"span",1),i.TgZ(3,"span"),i._uU(4),i.qZA()(),i.BQk()),2&d&&(i.xp6(4),i.Oqu(l.text))},dependencies:[h.Ls,r.ix,g.w,C.dQ],styles:["@media (min-width: 0px) and (max-width: 900px){button[_ngcontent-%COMP%]{width:auto!important;height:5vh!important}}"]})},7190:(E,P,n)=>{n.d(P,{M:()=>d});var i=n(4006),o=n(1256),h=n(5698),r=n(4650),g=n(8043),C=n(6895),t=n(8231);function f(l,c){if(1&l&&(r.TgZ(0,"nz-option",2),r._uU(1),r.qZA()),2&l){const s=c.$implicit;r.hYB("nzLabel","",s.address," (",s.name,")"),r.s9C("nzValue",s.address),r.xp6(1),r.AsE(" ",s.address," (",s.name,") ")}}class d{constructor(c,s){this.appFacades=c,this.stateFacade=s,this.address=new i.NI,this.addressChange=new r.vpe,this.addresses=[]}ngOnInit(){this.stateFacade.selectUser().pipe((0,h.q)(1)).subscribe(c=>{this.appFacades.getUserAddress(c?.id).pipe((0,h.q)(1)).subscribe(s=>{this.addresses=s.returnObject})})}}d.\u0275fac=function(c){return new(c||d)(r.Y36(g.h),r.Y36(o.R))},d.\u0275cmp=r.Xpm({type:d,selectors:[["s-s-safe-connect"]],inputs:{address:"address"},outputs:{addressChange:"addressChange"},decls:2,vars:2,consts:[["nzShowSearch","","nzAllowClear","","nzPlaceHolder","Adresse Safe Connect",3,"formControl"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzCustomContent","",3,"nzLabel","nzValue"]],template:function(c,s){1&c&&(r.TgZ(0,"nz-select",0),r.YNc(1,f,2,5,"nz-option",1),r.qZA()),2&c&&(r.Q6J("formControl",s.address),r.xp6(1),r.Q6J("ngForOf",s.addresses))},dependencies:[C.sg,i.JJ,i.oH,t.Ip,t.Vq],styles:["nz-select[_ngcontent-%COMP%]{width:100%!important}"]})},4270:(E,P,n)=>{n.d(P,{E:()=>l});var i=n(9073),o=n(4650),h=n(4006),r=n(9646),g=n(4004),C=n(5698),t=n(6895),f=n(8231);function d(c,s){if(1&c&&(o.TgZ(0,"nz-option",2),o._UZ(1,"img",3),o._uU(2),o.qZA()),2&c){const y=s.$implicit;o.s9C("nzLabel",y.asset_id),o.s9C("nzValue",y.asset_id),o.xp6(1),o.s9C("src",y.url,o.LSH),o.xp6(1),o.hij(" ",y.asset_id," ")}}class l{constructor(s){this.apiFunctionService=s,this.cryptoChange=new o.vpe,this.crypto=new h.NI,this.typeTransaction="Achat",this.typeOfPaymentMethod="Full",this.cryptos$=(0,r.of)([])}ngOnInit(){switch(this.typeOfPaymentMethod){case"crypto":this.cryptos$=this.apiFunctionService.cryptoIconsSelf$.pipe((0,g.U)(s=>s),(0,C.q)(1));break;case"electronic":this.cryptos$=this.apiFunctionService.localCurreny$.pipe((0,g.U)(s=>s),(0,C.q)(1));break;default:this.cryptos$=this.apiFunctionService.cryptoIcons$.pipe((0,g.U)(s=>s),(0,C.q)(1))}}}l.\u0275fac=function(s){return new(s||l)(o.Y36(i.L))},l.\u0275cmp=o.Xpm({type:l,selectors:[["s-select"]],inputs:{crypto:"crypto",typeTransaction:"typeTransaction",typeOfPaymentMethod:"typeOfPaymentMethod"},outputs:{cryptoChange:"cryptoChange"},features:[o._Bn([i.L])],decls:3,vars:4,consts:[["nzShowSearch","","nzAllowClear","","nzPlaceHolder","Selectionner la crypto",3,"formControl"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzCustomContent","",3,"nzLabel","nzValue"],["width","30","height","30",3,"src"]],template:function(s,y){1&s&&(o.TgZ(0,"nz-select",0),o.YNc(1,d,3,4,"nz-option",1),o.ALo(2,"async"),o.qZA()),2&s&&(o.Q6J("formControl",y.crypto),o.xp6(1),o.Q6J("ngForOf",o.lcZ(2,2,y.cryptos$)))},dependencies:[t.sg,h.JJ,h.oH,f.Ip,f.Vq,t.Ov],styles:["nz-select[_ngcontent-%COMP%]{width:100%}"]})},5047:(E,P,n)=>{n.r(P),n.d(P,{PaymentModule:()=>T});var i=n(4036),o=n(205),h=n(5950),r=n(1005),g=n(4006),C=n(7742),t=n(4650),f=n(7627),d=n(4270),l=n(7190),c=n(9019),s=n(6616),y=n(7044),A=n(1664);class O{constructor(){this.paymentHandler=null,this.transactionDetail=new t.vpe}makePayment(){window.StripeCheckout.configure({key:c.N.STRIPE_PUBLIC_KEY,locale:"us",token:e=>{this.transactionDetail.emit(e),alert("Stripe token generated!")}}).open({name:"SafePay Secure",description:"Checkout",amount:100*this.amount})}invokeStripe(){if(!window.document.getElementById("stripe-script")){const a=window.document.createElement("script");a.id="stripe-script",a.type="text/javascript",a.src="https://checkout.stripe.com/checkout.js",a.onload=()=>{this.paymentHandler=window.StripeCheckout.configure({key:"sk_test_51MkViLLBXl8JUOh83RWGIM6ragfLsaIkiENURTtnbkBDwHdCEXA84NQ5hpvhrCS9fDh4UgyHjjAp3QgL5SU8jkKv005p4EdwRW",locale:"auto",token:function(e){console.log(e),alert("Payment has been successfull!")}})},window.document.body.appendChild(a)}}ngOnInit(){this.invokeStripe()}ngOnDestroy(){}}O.\u0275fac=function(a){return new(a||O)},O.\u0275cmp=t.Xpm({type:O,selectors:[["s-stripe-payment"]],inputs:{amount:"amount"},outputs:{transactionDetail:"transactionDetail"},decls:2,vars:0,consts:[["nz-button","",1,"col-md-12",3,"click"]],template:function(a,e){1&a&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return e.makePayment()}),t._uU(1," Payer maintenant"),t.qZA())},dependencies:[s.ix,y.w,A.dQ]});var z=n(1971),Z=n(5635),x=n(6895);function S(p,a){if(1&p){const e=t.EpF();t.ynx(0,12),t.TgZ(1,"div",1)(2,"h5",13),t._uU(3,"Paiement Par Cryptomonnaie"),t.qZA(),t._UZ(4,"br"),t.TgZ(5,"s-s-safe-connect",14),t.NdJ("addressChange",function(_){t.CHM(e);const u=t.oxw();return t.KtG(u.address=_)}),t.qZA(),t._UZ(6,"br")(7,"br"),t.TgZ(8,"s-select",15),t.NdJ("cryptoChange",function(_){t.CHM(e);const u=t.oxw();return t.KtG(u.crypto=_)}),t.qZA(),t._UZ(9,"br")(10,"br"),t.TgZ(11,"input",16),t.NdJ("ngModelChange",function(_){t.CHM(e);const u=t.oxw();return t.KtG(u.transactionAmount=_)}),t.qZA(),t._UZ(12,"br")(13,"br"),t.TgZ(14,"button",17),t.NdJ("click",function(){t.CHM(e);const _=t.oxw();return t.KtG(_.makePayment())}),t._uU(15,"Confirmer"),t.qZA()(),t.BQk()}if(2&p){const e=t.oxw();t.xp6(5),t.Q6J("address",e.address),t.xp6(3),t.Q6J("typeOfPaymentMethod","crypto")("crypto",e.crypto),t.xp6(3),t.Q6J("ngModel",e.transactionAmount)("disabled",!0),t.xp6(3),t.Q6J("nzLoading",e.isLoading)}}function U(p,a){if(1&p){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"h5",13),t._uU(3,"Paiement Par carte"),t.qZA(),t._UZ(4,"br")(5,"br"),t.TgZ(6,"input",16),t.NdJ("ngModelChange",function(_){t.CHM(e);const u=t.oxw();return t.KtG(u.transactionAmount=_)}),t.qZA(),t._UZ(7,"br")(8,"br"),t.TgZ(9,"s-stripe-payment",18),t.NdJ("transactionDetail",function(_){t.CHM(e);const u=t.oxw();return t.KtG(u.getVisaTransactionDetail(_))}),t.qZA()(),t.BQk()}if(2&p){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.transactionAmount)("disabled",!0),t.xp6(3),t.Q6J("amount",e.transactionAmount)}}function D(p,a){if(1&p){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"h5",13),t._uU(3,"Paiement Monnaie electronic"),t.qZA(),t._UZ(4,"br")(5,"s-s-safe-connect")(6,"br")(7,"br")(8,"s-select",19)(9,"br")(10,"br"),t.TgZ(11,"input",16),t.NdJ("ngModelChange",function(_){t.CHM(e);const u=t.oxw();return t.KtG(u.transactionAmount=_)}),t.qZA(),t._UZ(12,"br")(13,"br"),t.TgZ(14,"button",20),t._uU(15,"Confirmer"),t.qZA()(),t.BQk()}if(2&p){const e=t.oxw();t.xp6(8),t.Q6J("typeOfPaymentMethod","electronic"),t.xp6(3),t.Q6J("ngModel",e.transactionAmount)("disabled",!0)}}class v{constructor(a,e,m){this.activatedRoute=a,this.router=e,this.appState=m,this.payment="electronic",this.crypto=new g.NI,this.address=new g.NI,this.isLoading=!1,this.crypto.valueChanges.subscribe(_=>this.getExchange(_))}ngOnInit(){this.activatedRoute.queryParamMap.subscribe(a=>{this.transactionAmount=Number.parseInt(a.get("amount"))/660,this.planId=a.get("plan"),this.userId=a.get("inc"),console.log(a)})}activePaymentMethod(a){this.payment=a}getVisaTransactionDetail(a){console.log("parent node",a)}makePayment(){this.saveTransaction()}saveTransaction(){const a={typeTransaction:"Billing",userId:this.userId,planId:this.planId,amount:this.transactionAmount.toString(),mean_of_payment:this.crypto.value,address:this.address.value};this.checkPaymentField(a)?(this.isLoading=!0,this.appState.AppFacades.planSubscription(a).pipe((0,r.g)(2e3)).subscribe({next:e=>{const m=e.returnObject;console.log(e),this.router.navigate(["/transaction/success"],{queryParams:{transactionId:m.Ref}}),this.appState.updateUser({user:m.User,token:""}),this.appState.AppFacades.mBuildSuccess(e.message),this.isLoading=!1},error:e=>{this.isLoading=!1,this.appState.AppFacades.mBuildError(e.error.message?e.error.message:e.message)}})):this.appState.AppFacades.mBuildError("Veuillez renseigner tout les champs")}checkPaymentField(a){return 0==(0,h.l)(a).count}getExchange(a){this.appState.AppFacades.getCryptoExchange("USD",a).subscribe(e=>{console.log(e),this.transactionAmount=this.transactionAmount*e.rate})}}v.\u0275fac=function(a){return new(a||v)(t.Y36(o.gz),t.Y36(o.F0),t.Y36(C.B))},v.\u0275cmp=t.Xpm({type:v,selectors:[["t-gateway"]],decls:20,vars:7,consts:[[1,"wrapper"],[1,"container"],[1,"main-card"],[3,"text"],[1,"grid","container","pay_method",2,"margin-top","3%"],[1,"row","justify-content-center"],[1,"col-md-3","payment",3,"ngClass","click"],["src","/assets/imgs/payment/electronic.png","width","80","height","80",1,"img-fluid"],["src","/assets/imgs/payment/visa.png","width","200","height","80",1,"img-fluid"],["src","/assets/imgs/payment/crypto.png","width","80","height","80",1,"img-fluid"],["class","crypto",4,"ngIf"],[4,"ngIf"],[1,"crypto"],[2,"margin-top","3% !important"],[3,"address","addressChange"],[3,"typeOfPaymentMethod","crypto","cryptoChange"],["nz-input","","placeholder","montant de transaction",3,"ngModel","disabled","ngModelChange"],["nz-button","",1,"col-md-12",3,"nzLoading","click"],[3,"amount","transactionDetail"],[3,"typeOfPaymentMethod"],["nz-button","",1,"col-md-12"]],template:function(a,e){1&a&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"br")(3,"br"),t.TgZ(4,"nz-card",2),t._UZ(5,"app-back-button",3),t.TgZ(6,"div",4)(7,"div",5)(8,"nz-card",6),t.NdJ("click",function(){return e.activePaymentMethod("electronic")}),t._UZ(9,"img",7),t.qZA(),t.TgZ(10,"nz-card",6),t.NdJ("click",function(){return e.activePaymentMethod("visa")}),t._UZ(11,"img",8),t.qZA(),t.TgZ(12,"nz-card",6),t.NdJ("click",function(){return e.activePaymentMethod("crypto")}),t._UZ(13,"img",9),t.qZA()()(),t.YNc(14,S,16,6,"ng-container",10),t.YNc(15,U,10,3,"ng-container",11),t.YNc(16,D,16,3,"ng-container",11),t.qZA()(),t._UZ(17,"br")(18,"br")(19,"br"),t.qZA()),2&a&&(t.xp6(5),t.Q6J("text","Retour"),t.xp6(3),t.Q6J("ngClass","electronic"==e.payment?"active":"inactive"),t.xp6(2),t.Q6J("ngClass","visa"==e.payment?"active":"inactive"),t.xp6(2),t.Q6J("ngClass","crypto"==e.payment?"active":"inactive"),t.xp6(2),t.Q6J("ngIf","crypto"==e.payment),t.xp6(1),t.Q6J("ngIf","visa"==e.payment),t.xp6(1),t.Q6J("ngIf","electronic"==e.payment))},dependencies:[f.W,d.E,l.M,O,s.ix,y.w,A.dQ,z.bd,Z.Zp,g.Fj,g.JJ,x.mk,x.O5,g.On],styles:[".main-card[_ngcontent-%COMP%]{margin-left:20%;margin-top:2%!important;width:800px;height:90vh}.wrapper[_ngcontent-%COMP%]{margin:-2% 0 0;padding:0;width:100%;height:100%;background-color:var(--base-color)}.crypto[_ngcontent-%COMP%]{width:40%!important}.active[_ngcontent-%COMP%]{border:1px solid var(--base-color)}.pay_method[_ngcontent-%COMP%]   nz-card[_ngcontent-%COMP%]{margin:10px;height:100px;text-align:center;cursor:pointer}.pay_method[_ngcontent-%COMP%]   nz-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-top:-10%}.pay_method[_ngcontent-%COMP%]   nz-card[_ngcontent-%COMP%]:hover{box-shadow:0 0 10px #0000001a}@media (min-width: 0px) and (max-width: 1200px){.main-card[_ngcontent-%COMP%]{margin-left:auto;margin-top:2%;width:auto;height:auto}.main-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;margin-top:0%!important}}"]});const I=[{path:"",component:v},{path:"transaction",component:v,canActivate:[i.V],children:[{path:"checkout/:id",component:v}]}];class M{}M.\u0275fac=function(a){return new(a||M)},M.\u0275mod=t.oAB({type:M}),M.\u0275inj=t.cJS({imports:[o.Bz.forChild(I),o.Bz]});var b=n(1512),B=n(8521);class T{}T.\u0275fac=function(a){return new(a||T)},T.\u0275mod=t.oAB({type:T}),T.\u0275inj=t.cJS({imports:[M,b.D,B.aF]})}}]);